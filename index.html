<!DOCTYPE html>
<html>
<head>
  <title>Robo Delivery | Grocery Order</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body {
      background: linear-gradient(135deg, #b2a1ff 0%, #99e5ff 100%);
      min-height:100vh;margin:0;font-family:'Segoe UI',Arial,sans-serif;
      color:#38307c;background-attachment:fixed;
    }
    .header {
      font-size:2.1em;text-align:center;font-weight:900;padding:38px 0 14px 0;letter-spacing:.04em;
      color:#5749b7;text-shadow:0 8px 40px #c3c8f9;
    }
    .content {
      max-width:420px;margin:0 auto;background:rgba(255,255,255,0.95);border-radius:29px;
      padding:16px 17px 24px 17px;box-shadow:0 7px 29px #c4cbf988;
    }
    .grid {
      display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-bottom:9px;
    }
    .prod {
      background:rgba(220,206,255,0.85);border-radius:16px;border:1.7px solid #b6b4fc;
      padding:16px 11px 24px 11px; width:124px; text-align:center; margin-top:10px;
      box-shadow:0 1px 11px #d6cfff63;transition:transform .18s;
    }
    .prod:hover {transform:scale(1.06);}
    .prod img {width:45px;height:45px;border-radius:12px;box-shadow:0 1px 3px #e2e0fb96;}
    .prod-name {font-size:1em;font-weight:800;padding-top:5px;color:#5749b7;}
    .prod-price {font-size:.91em;color:#7344df;}
    .qty-row {display:flex;align-items:center;justify-content:center;gap:11px;margin-top:9px;}
    .qty-btn {background:#7344df;color:#fff;font-size:1.09em;font-weight:900;
      border:none;padding:5px 15px;border-radius:10px;cursor:pointer;}
    .qty-num {min-width:20px;text-align:center;font-size:1.13em;color:#3882c3;font-weight:900;}
    .cart-area {
      background:rgba(160,180,255,0.41);border-radius:14px;max-width:390px;
      margin:12px auto 0; padding:13px 13px 13px 13px;
      box-shadow: 0 1px 7px #b3d3fc62;color:#6245a8;
    }
    .cart-badge {
      background:#7344df;color:#fff;font-weight:900;border-radius:49px;width:31px;height:31px;
      text-align:center;display:inline-block;margin-left:6px;font-size:1em;box-shadow:0 1px 7px #f2e9fc;}
    .cart-item-row {display:flex;align-items:center;gap:8px;margin-bottom:8px;}
    .cart-item-name {font-size:.97em;font-weight:700;}
    .cart-item-qty {color:#5778cf;font-size:.94em;}
    .cart-item-price {font-size:.99em;color:#af5cff;}
    .cart-rm-btn {background:#7344df;color:#fff;border:none;border-radius:8px;font-size:0.97em;padding:2px 10px;cursor:pointer;}
    .cart-total {color:#3882c3;font-weight:900;font-size:1.14em;margin:13px 0 8px 0;}
    .order-box {
      background:rgba(244,242,251,0.72);box-shadow:0 0px 10px #aaa1fd36;
      border-radius:13px; padding:11px 12px;margin-top:7px;
    }
    .ord-btn {
      background: #af5cff; color:#fff;font-weight:900;font-size:1.25em;border:none;
      border-radius:14px;box-shadow:0 5px 22px #af5cff44;
      padding:13px 0;width:100%;margin-top:11px;cursor:pointer;
      transition:box-shadow .11s,transform .09s,background .09s;
    }
    .ord-btn:active {background:#7344df;box-shadow:0 8px 28px #6245a844;transform:scale(1.05);}
    .statusbar {
      background:#b0cdfa;color:#5447b7;font-weight:900;border-radius:13px;
      padding:13px 0;margin:18px 0 7px 0;text-align:center;font-size:1.08em;
    }
    input,select {
      width:97%;border-radius:9px;margin-bottom:12px;font-size:1em;padding:9px;border:1.3px solid #7344df;
      background:#e3e7fb;font-weight:700;
    }
    .otpModal {
      display:none; position:fixed; left: 50vw; top:46vh; transform:translate(-50%,-46%);
      background: #b2a1ff; color:#4e4b94;border-radius:18px; padding:29px 22px;z-index:10;font-size:1.2em;box-shadow:0 7px 19px #b2a1ff44;
    }
    .otpModal.show {display:block;}
    .close-btn {
      background:#7344df;color:#fff;font-size:1em;font-weight:700;border:none;border-radius:9px; padding:11px 28px;margin-top:21px;box-shadow:0 2px 7px #ded7ffbb;cursor:pointer;}
    @media (max-width:500px) {.content{max-width:99vw;}.cart-area{max-width:97vw;}}
  </style>
</head>
<body>
  <div class="header">Robo Delivery | Grocery Order</div>
  <div class="content">
    <div class="grid" id="catalog"></div>
    <div class="cart-area" id="cartBar" style="display:none;">
      <b>Cart <span class="cart-badge" id="cartBadge" style="display:none;">0</span></b>
      <div id="cartItems"></div>
      <div class="cart-total" id="cartTotal"></div>
    </div>
    <div class="order-box">
      <input id="name" placeholder="Your Name" maxlength="18">
      <select id="location">
        <option>Select Delivery Location</option>
        <option>Block A</option><option>Block B</option>
        <option>Hostel</option><option>Library</option>
        <option>Lab 1</option><option>Lab 2</option>
        <option>Staffroom</option>
      </select>
      <input id="password" type="password" autocomplete="off" maxlength="6" placeholder="Set 6-digit Password">
      <button class="ord-btn" onclick="placeOrder()">üõí Place Order</button>
      <div class="statusbar" id="status"><span>Waiting for order...</span></div>
    </div>
  </div>
  <div class="otpModal" id="otpModal">
    <h2 style="margin-top:0;margin-bottom:15px;">Delivery OTP</h2>
    <div id="otpText" style="font-size:2em;color:#7344df;margin-bottom:9px;letter-spacing:.16em;"></div>
    <button class="close-btn" onclick="closeModal()">Close</button>
  </div>
  <script>
const products = [
  {name:"Potato (1kg)",price:22,img:"https://images.pexels.com/photos/4110255/pexels-photo-4110255.jpeg"},
  {name:"Milk 500ml",price:27,img:"https://images.pexels.com/photos/65175/pexels-photo-65175.jpeg"},
  {name:"Brown Bread",price:32,img:"https://images.pexels.com/photos/461382/pexels-photo-461382.jpeg"},
  {name:"Onion (1kg)",price:15,img:"https://images.pexels.com/photos/742755/pexels-photo-742755.jpeg"},
  {name:"Eggs (6)",price:34,img:"https://images.pexels.com/photos/162712/pexels-photo-162712.jpeg"},
  {name:"Apples (4)",price:50,img:"https://images.pexels.com/photos/102104/pexels-photo-102104.jpeg"},
  {name:"Tomato (1kg)",price:19,img:"https://images.pexels.com/photos/1435906/pexels-photo-1435906.jpeg"}
];
const API = "https://robo-delivery-backend-production.up.railway.app"; // <-- Use your backend URL!
let cart = [];
function renderCatalog() {
  let h = "";
  products.forEach((p,i)=>{
    h+=`<div class="prod">
      <img src="${p.img}" alt="prod">
      <div class="prod-name">${p.name}</div>
      <div class="prod-price">‚Çπ${p.price}</div>
      <div class="qty-row">
        <button class="qty-btn" onclick="changeQty(${i},-1)">‚àí</button>
        <span class="qty-num">${cart.find(x=>x.idx==i)?.qty||0}</span>
        <button class="qty-btn" onclick="changeQty(${i},1)">+</button>
      </div>
    </div>`;
  });
  catalog.innerHTML = h;
}
function changeQty(idx,delta){
  let found = cart.find(x=>x.idx==idx);
  if(found) {
    found.qty += delta;
    if(found.qty<=0) cart = cart.filter(x=>x.idx!=idx);
  } else if(delta>0) {
    cart.push({idx:idx,qty:1});
  }
  renderCatalog(); renderCart();
}
function renderCart() {
  if(!cart.length) { cartBar.style.display="none"; cartBadge.style.display="none"; return;}
  cartBar.style.display="block";
  cartBadge.style.display="inline-block";
  cartBadge.innerText=cart.reduce((n,x)=>n+x.qty,0);
  cartItems.innerHTML = cart.map(x=>{
    let p = products[x.idx];
    return `<div class="cart-item-row">
      <span class="cart-item-name">${p.name}</span>
      <span class="cart-item-qty">x${x.qty}</span>
      <span class="cart-item-price">‚Çπ${p.price*x.qty}</span>
      <button class="cart-rm-btn" onclick="removeFromCart(${x.idx})">Remove</button>
    </div>`;
  }).join("");
  cartTotal.innerHTML = "Total: ‚Çπ"+cart.reduce((s,x)=>s+products[x.idx].price*x.qty,0);
}
function removeFromCart(idx) {
  cart = cart.filter(x=>x.idx!=idx);
  renderCatalog(); renderCart();
}
function isSixDigitPassword(pwd) {
  // Validate exactly 6 digits, only numbers
  return /^d{6}$/.test(pwd);
}
function placeOrder() {
  if(!cart.length) { status.innerHTML='<span>üõí Add some items!</span>'; return; }
  if(!isSixDigitPassword(password.value)) {
    status.innerHTML='<span style="color:#af5cff">Set 6-digit numeric password!</span>';
    password.style.borderColor="#af5cff";
    password.focus();
    return;
  } else {
    password.style.borderColor="#7344df";
  }
  let items = cart.map(x=>products[x.idx].name+" x"+x.qty).join(", ");
  fetch(API + "/orders", {
    method: "POST",
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      name: name.value,
      location: location.value,
      item: items,
      password: password.value
    })})
    .then(r=>r.json()).then(out=>{
      status.innerHTML = '<span>‚è≥ Order Placed - Waiting for Shopkeeper!</span>';
      setTimeout(refreshStatus, 1300);
      cart=[]; renderCart(); renderCatalog();
    });
}
function refreshStatus() {
  fetch(API + "/orders").then(res => res.json()).then(data => {
    let txt="", ico="‚åõ";
    let order = Array.isArray(data) ? data.find(o => o.name === name.value) : data;
    if (!order) { txt="Waiting for order..."; }
    else if (order.status=="ORDERED") txt="Order Placed - Waiting for Shopkeeper!";
    else if (order.status=="DISPATCHED") txt="Robo Delivering!";
    else if (order.status=="ARRIVED_AT_CUSTOMER") {
      txt=`Robo Arrived! Enter password and OTP (shown here) at robo keypad.`;
      showOTP(order.otp);
    }
    else if (order.status=="DELIVERY_COMPLETED") txt="Delivered! Enjoy ü•≥";
    status.innerHTML = `<span>${txt}</span>`;
  });
}
function showOTP(code) {
  if (!code) return;
  otpText.innerText = code;
  otpModal.classList.add("show");
}
function closeModal() { otpModal.classList.remove("show"); }
renderCatalog();
renderCart();
setInterval(refreshStatus, 2200);
refreshStatus();
  </script>
</body>
</html>
